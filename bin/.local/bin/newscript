#!/bin/bash

set -e

if [ "$1" = "-h" ] || [ "$1" = "--help" ]; then
    echo "Usage: $(basename "$0") [OPTIONS] <SCRIPT_NAME>"
    echo "Create a new shell script"
    echo "Options:"
    echo "  -h, --help    Show this help message and exit"
    exit 0
fi

if [ ! -n "${XDG_BIN_HOME+x}" ]; then
    echo "Please set 'XDG_BIN_HOME' for this script to work. Usually this is '$HOME/.local/bin'."
    exit 1
fi

SCRIPT_NAME=$1

while [ -z "$SCRIPT_NAME" ]; do
    echo -n "Enter a script name: " >&2
    read -r SCRIPT_NAME

    if [ -s "$SCRIPT_NAME" ]; then
        echo "A script or executable with the name '$SCRIPT_NAME' already exists." >&2
        SCRIPT_NAME=""
    fi
done

# Perhaps some validation code here?
#

SCRIPT_PATH=$XDG_BIN_HOME/$SCRIPT_NAME

sudo touch "$SCRIPT_PATH" &>/dev/null
sudo chmod 777 "$SCRIPT_PATH"

echo "#!/bin/bash" >>"$SCRIPT_PATH"
echo "echo \"$SCRIPT_PATH is running!\"" >>"$SCRIPT_PATH"
echo "Successfully created a new script $SCRIPT_NAME at $SCRIPT_PATH." >&2

if [ -n "${EDITOR+x}" ]; then
    $EDITOR "$SCRIPT_PATH"
else
    echo "EDITOR is not set, set it to edit new scripts after creation."
fi
